<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; PyDGN 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pydgn.data" href="source/pydgn.data.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> PyDGN
            <img src="_static/pydgn-logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Intro and Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-preprocessing">Data Preprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-splitting">Data Splitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dataset-creation">Dataset Creation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#experiment-setup">Experiment Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-information">Data Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hardware">Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-loading">Data Loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#experiment-details">Experiment Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="#grid-search">Grid Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="#random-search">Random Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="#experiment">Experiment</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="source/pydgn.data.html">pydgn.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/pydgn.evaluation.html">pydgn.evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/pydgn.experiment.html">pydgn.experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/pydgn.log.html">pydgn.log</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/pydgn.model.html">pydgn.model</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/pydgn.training.html">pydgn.training</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyDGN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline"></a></h1>
<p>Knowing how to set up valid YAML configuration files is fundamental to properly use <strong>PyDGN</strong>. Custom behavior with
more advanced functionalities can be generally achieved by subclassing the individual modules we provide,
but this is very much dependent on the specific research project.</p>
<section id="data-preprocessing">
<h2>Data Preprocessing<a class="headerlink" href="#data-preprocessing" title="Permalink to this headline"></a></h2>
<p>The ML pipeline starts with the creation of the dataset and of the data splits. The general template that we can use is
the following, with an explanation of each field as a comment:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">splitter</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">root</span><span class="p">:</span><span class="w">  </span><span class="c1"># folder where to store the splits</span><span class="w"></span>
<span class="w">  </span><span class="nt">class_name</span><span class="p">:</span><span class="w">  </span><span class="c1"># dotted path to splitter class</span><span class="w"></span>
<span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">n_outer_folds</span><span class="p">:</span><span class="w">  </span><span class="c1"># number of outer folds for risk assessment</span><span class="w"></span>
<span class="w">    </span><span class="nt">n_inner_folds</span><span class="p">:</span><span class="w">  </span><span class="c1"># number of inner folds for model selection</span><span class="w"></span>
<span class="w">    </span><span class="nt">seed</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">stratify</span><span class="p">:</span><span class="w">  </span><span class="c1"># target stratification: works for graph classification tasks only</span><span class="w"></span>
<span class="w">    </span><span class="nt">shuffle</span><span class="p">:</span><span class="w">  </span><span class="c1"># whether to shuffle the indices prior to splitting</span><span class="w"></span>
<span class="w">    </span><span class="nt">inner_val_ratio</span><span class="p">:</span><span class="w">  </span><span class="c1"># percentage of validation for hold-out model selection. this will be ignored when the number of inner folds is &gt; than 1</span><span class="w"></span>
<span class="w">    </span><span class="nt">outer_val_ratio</span><span class="p">:</span><span class="w">  </span><span class="c1"># percentage of validation data to extract for risk assessment final runs</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_ratio</span><span class="p">:</span><span class="w">  </span><span class="c1"># percentage of test to extract for hold-out risk assessment. this will be ignored when the number of outer folds is &gt; than 1</span><span class="w"></span>
<span class="nt">dataset</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">root</span><span class="p">:</span><span class="w">  </span><span class="c1"># path to data root folder</span><span class="w"></span>
<span class="w">  </span><span class="nt">class_name</span><span class="p">:</span><span class="w">  </span><span class="c1"># dotted path to dataset class</span><span class="w"></span>
<span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w">  </span><span class="c1"># arguments to pass to the dataset class</span><span class="w"></span>
<span class="w">    </span><span class="nt">arg_name1</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">arg_namen</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">transform</span><span class="p">:</span><span class="w"> </span><span class="c1"># on the fly transforms: useful for social datasets with no node features (with an example)</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pydgn.data.transform.ConstantIfEmpty</span><span class="w"></span>
<span class="w">      </span><span class="nt">args</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="c1"># pre_transform:  # transform data and store it at dataset creation time</span><span class="w"></span>
<span class="w">  </span><span class="c1"># pre_filter:  # filter data and store it at dataset creation time</span><span class="w"></span>
</pre></div>
</div>
<section id="data-splitting">
<h3>Data Splitting<a class="headerlink" href="#data-splitting" title="Permalink to this headline"></a></h3>
<p>We provide a general <a class="reference internal" href="source/pydgn.data.html#pydgn.data.splitter.Splitter" title="pydgn.data.splitter.Splitter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Splitter</span></code></a> class that is able to split a dataset of multiple graphs. The most important parameters
are arguably <code class="docutils literal notranslate"><span class="pre">n_outer_folds</span></code> and <code class="docutils literal notranslate"><span class="pre">n_inner_folds</span></code>, which represent the way in which we want to perform <strong>risk assessment</strong>
and <strong>model selection</strong>. For instance:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n_outer_folds=10</span></code> and <code class="docutils literal notranslate"><span class="pre">n_inner_folds=1</span></code>: 10-fold external Cross Validation (CV) on test data, with hold-out model selection inside each of the 10 folds,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_outer_folds=5</span></code> and <code class="docutils literal notranslate"><span class="pre">n_inner_folds=3</span></code>: Nested CV,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_outer_folds=1</span></code> and <code class="docutils literal notranslate"><span class="pre">n_inner_folds=1</span></code>: Simple Hold-out model assessment and selection, or <code class="docutils literal notranslate"><span class="pre">train/val/test</span></code> split.</p></li>
</ul>
</div></blockquote>
<p>We assume that the difference between <strong>risk assessment</strong> and <strong>model selection</strong> is clear to the reader.
If not, please refer to <a class="reference external" href="https://bengio.abracadoudou.com/lectures/theory.pdf">Samy Bengio’s lecture (Part 3)</a>.</p>
<p>Here’s an snippet of a potential configuration file that splits a graph classification dataset:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">splitter</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">examples/DATA_SPLITS/CHEMICAL</span><span class="w"></span>
<span class="w">  </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pydgn.data.splitter.Splitter</span><span class="w"></span>
<span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">n_outer_folds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>
<span class="w">    </span><span class="nt">n_inner_folds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">    </span><span class="nt">seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span><span class="w"></span>
<span class="w">    </span><span class="nt">stratify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"></span>
<span class="w">    </span><span class="nt">shuffle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"></span>
<span class="w">    </span><span class="nt">inner_val_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w"></span>
<span class="w">    </span><span class="nt">outer_val_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w"></span>
<span class="w">    </span><span class="nt">test_ratio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="dataset-creation">
<h3>Dataset Creation<a class="headerlink" href="#dataset-creation" title="Permalink to this headline"></a></h3>
<p>To create your own dataset, you should implement the <a class="reference internal" href="source/pydgn.data.html#pydgn.data.dataset.DatasetInterface" title="pydgn.data.dataset.DatasetInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatasetInterface</span></code></a> interface. For
instance, we provide a wrapper around the <a class="reference external" href="https://pytorch-geometric.readthedocs.io/en/latest/modules/datasets.html#torch_geometric.datasets.TUDataset">TUDataset</a>
dataset of Pytorch Geometric in <a class="reference internal" href="source/pydgn.data.html#pydgn.data.dataset.TUDatasetInterface" title="pydgn.data.dataset.TUDatasetInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">TUDatasetInterface</span></code></a>, which you can check to get an idea.</p>
<p>Here’s an snippet of a potential configuration file that downloads and processes the <code class="docutils literal notranslate"><span class="pre">PROTEINS</span></code> graph classification dataset:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dataset</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATA/</span><span class="w"></span>
<span class="w">  </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pydgn.data.dataset.TUDataset</span><span class="w"></span>
<span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">root</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATA/</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PROTEINS</span><span class="w"></span>
</pre></div>
</div>
<p>You can also apply <code class="docutils literal notranslate"><span class="pre">transform</span></code>, <code class="docutils literal notranslate"><span class="pre">pre_transform</span></code> and <code class="docutils literal notranslate"><span class="pre">pre_filter</span></code> that follow the same semantic of PyG.</p>
<p>Once our data configuration file is ready, we can create the dataset using (for the example above)</p>
</section>
</section>
<section id="experiment-setup">
<h2>Experiment Setup<a class="headerlink" href="#experiment-setup" title="Permalink to this headline"></a></h2>
<p>Once we have created a dataset and its data splits, it is time to implement our model and define a suitable task.
Every model must implement the <a class="reference internal" href="source/pydgn.model.html#pydgn.model.interface.ModelInterface" title="pydgn.model.interface.ModelInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelInterface</span></code></a> interface, and it can optionally use a
readout module that must implement the <a class="reference internal" href="source/pydgn.model.html#pydgn.model.interface.ReadoutInterface" title="pydgn.model.interface.ReadoutInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReadoutInterface</span></code></a>.</p>
<p>At this point, it is time to define the experiment. The general template that we can use is the following, with an
explanation of each field as a comment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dataset and Splits</span>
<span class="n">data_root</span><span class="p">:</span>  <span class="c1"># path to DATA root folder (same as in data config file)</span>
<span class="n">dataset_class</span><span class="p">:</span>  <span class="c1"># dotted path to dataset class</span>
<span class="n">dataset_name</span><span class="p">:</span>  <span class="c1"># dataset name (same as in data config file)</span>
<span class="n">data_splits_file</span><span class="p">:</span>  <span class="c1"># path to data splits file</span>


<span class="c1"># Hardware</span>
<span class="n">device</span><span class="p">:</span>  <span class="c1"># cpu | cuda</span>
<span class="n">max_cpus</span><span class="p">:</span>  <span class="c1"># &gt; 1 for parallelism</span>
<span class="n">max_gpus</span><span class="p">:</span> <span class="c1"># &gt; 0 for gpu usage (device must be cuda though)</span>
<span class="n">gpus_per_task</span><span class="p">:</span>  <span class="c1"># percentage of gpus to allocate for each task</span>


<span class="c1"># Data Loading</span>
<span class="n">dataset_getter</span><span class="p">:</span>  <span class="c1"># dotted path to dataset provider class</span>
<span class="n">data_loader</span><span class="p">:</span>
  <span class="n">class_name</span><span class="p">:</span>  <span class="c1"># dotted path to data loader class</span>
  <span class="n">args</span><span class="p">:</span>
    <span class="n">num_workers</span> <span class="p">:</span>
    <span class="n">pin_memory</span><span class="p">:</span>
    <span class="c1"># possibly other arguments (we set `worker_init_fn`, `sampler` and `shuffle`, so do not override)</span>


<span class="c1"># Reproducibility</span>
<span class="n">seed</span><span class="p">:</span> <span class="mi">42</span>


<span class="c1"># Experiment</span>
<span class="n">result_folder</span><span class="p">:</span>  <span class="c1"># path of the folder where to store results</span>
<span class="n">exp_name</span><span class="p">:</span>  <span class="c1"># name of the experiment</span>
<span class="n">experiment</span><span class="p">:</span>  <span class="c1"># dotted path to experiment class</span>
<span class="n">higher_results_are_better</span><span class="p">:</span>  <span class="c1"># model selection: should we select based on max (True) or min (False) main score?</span>
<span class="n">evaluate_every</span><span class="p">:</span>  <span class="c1"># evaluate on train/val/test every `n` epochs and log results</span>
<span class="n">final_training_runs</span><span class="p">:</span>  <span class="c1"># how many final (model assessment) training runs to perform to mitigate bad initializations</span>

<span class="c1"># Grid Search</span>
<span class="c1"># if only 1 configuration is selected, any inner model selection will be skipped</span>
<span class="n">grid</span><span class="p">:</span>
  <span class="n">supervised_config</span><span class="p">:</span>
    <span class="n">model</span><span class="p">:</span>  <span class="c1"># dotted path to model class</span>
    <span class="n">checkpoint</span><span class="p">:</span>  <span class="c1"># whether to keep a checkpoint of the last epoch to resume training</span>
    <span class="n">shuffle</span><span class="p">:</span>  <span class="c1"># whether to shuffle the data</span>
    <span class="n">batch_size</span><span class="p">:</span>  <span class="c1"># batch size</span>
    <span class="n">epochs</span><span class="p">:</span>  <span class="c1"># number of maximum training epochs</span>

    <span class="c1"># Model specific arguments #</span>

    <span class="c1"># TBD</span>

    <span class="c1"># ------------------------ #</span>

    <span class="c1"># Optimizer (with an example - 3 possible alternatives)</span>
    <span class="n">optimizer</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">class_name</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">Optimizer</span>
        <span class="n">args</span><span class="p">:</span>
          <span class="n">optimizer_class_name</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span>
          <span class="n">lr</span><span class="p">:</span>
            <span class="o">-</span> <span class="mf">0.01</span>
            <span class="o">-</span> <span class="mf">0.001</span>
          <span class="n">weight_decay</span><span class="p">:</span> <span class="mf">0.</span>
      <span class="o">-</span> <span class="n">class_name</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">Optimizer</span>
        <span class="n">args</span><span class="p">:</span>
          <span class="n">optimizer_class_name</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adagrad</span>
          <span class="n">lr</span><span class="p">:</span>
            <span class="o">-</span> <span class="mf">0.1</span>
          <span class="n">weight_decay</span><span class="p">:</span> <span class="mf">0.</span>

    <span class="c1"># Scheduler (optional)</span>
    <span class="n">scheduler</span><span class="p">:</span> <span class="n">null</span>

    <span class="c1"># Loss metric (with an example of Additive Loss)</span>
    <span class="n">loss</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">class_name</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">AdditiveLoss</span>
        <span class="n">args</span><span class="p">:</span>
          <span class="n">loss_1</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MulticlassClassification</span>
          <span class="n">loss_2</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MulticlassClassification</span>

    <span class="c1"># Score metric (with an example of Multi Score)</span>
    <span class="n">scorer</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">class_name</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MultiScore</span>
        <span class="n">args</span><span class="p">:</span>
          <span class="n">main_scorer</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MulticlassAccuracy</span>
          <span class="n">my_second_metric</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">ToyMetric</span>

    <span class="c1"># Readout (optional)</span>
    <span class="n">readout</span><span class="p">:</span>

    <span class="c1"># Training engine</span>
    <span class="n">engine</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">TrainingEngine</span>

    <span class="c1"># Gradient clipper (optional)</span>
    <span class="n">gradient_clipper</span><span class="p">:</span> <span class="n">null</span>

    <span class="c1"># Early stopper (optional, with an example of &quot;patience&quot; early stopping on the validation score)</span>
    <span class="n">early_stopper</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">class_name</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">early_stopping</span><span class="o">.</span><span class="n">PatienceEarlyStopper</span>
        <span class="n">args</span><span class="p">:</span>
          <span class="n">patience</span><span class="p">:</span>
            <span class="o">-</span> <span class="mi">5</span>
          <span class="c1"># SYNTAX: (train_,validation_)[name_of_the_scorer_or_loss_to_monitor] -&gt; we can use MAIN_LOSS or MAIN_SCORE</span>
          <span class="n">monitor</span><span class="p">:</span> <span class="n">validation_main_score</span>
          <span class="n">mode</span><span class="p">:</span> <span class="nb">max</span>  <span class="c1"># is best the `max` or the `min` value we are monitoring?</span>
          <span class="n">checkpoint</span><span class="p">:</span> <span class="kc">True</span>  <span class="c1"># store the best checkpoint</span>

    <span class="c1"># Plotter of metrics</span>
    <span class="n">plotter</span><span class="p">:</span> <span class="n">pydgn</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">Plotter</span>
</pre></div>
</div>
<section id="data-information">
<h3>Data Information<a class="headerlink" href="#data-information" title="Permalink to this headline"></a></h3>
</section>
<section id="hardware">
<h3>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline"></a></h3>
</section>
<section id="data-loading">
<h3>Data Loading<a class="headerlink" href="#data-loading" title="Permalink to this headline"></a></h3>
</section>
<section id="experiment-details">
<h3>Experiment Details<a class="headerlink" href="#experiment-details" title="Permalink to this headline"></a></h3>
</section>
<section id="grid-search">
<h3>Grid Search<a class="headerlink" href="#grid-search" title="Permalink to this headline"></a></h3>
<p>There is one config file <code class="docutils literal notranslate"><span class="pre">examples/MODEL_CONFIGS/config_SupToyDGN.yml</span></code> that you can check.</p>
</section>
<section id="random-search">
<h3>Random Search<a class="headerlink" href="#random-search" title="Permalink to this headline"></a></h3>
<p>Specify a <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> in the config file with the number of random trials, replace <code class="docutils literal notranslate"><span class="pre">grid</span></code>
with <code class="docutils literal notranslate"><span class="pre">random</span></code>, and specify a sampling method for each hyper-parameter. We provide different sampling methods:</p>
<ul class="simple">
<li><p>choice –&gt; pick at random from a list of arguments</p></li>
<li><p>uniform –&gt; pick uniformly from min and max arguments</p></li>
<li><p>normal –&gt; sample from normal distribution with mean and std</p></li>
<li><p>randint –&gt; pick at random from min and max</p></li>
<li><p>loguniform –&gt; pick following the recprocal distribution from log_min, log_max, with a specified base</p></li>
</ul>
<p>There is one config file <code class="docutils literal notranslate"><span class="pre">examples/MODEL_CONFIGS/config_SupToyDGN_RandomSearch.yml</span></code> that you can check.</p>
</section>
<section id="experiment">
<h3>Experiment<a class="headerlink" href="#experiment" title="Permalink to this headline"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;This example demonstrates a simple BLE client that scans for devices,</span>
<span class="sd">connects to a device (GATT server) of choice and continuously reads a characteristic on that device.</span>

<span class="sd">The GATT Server in this example runs on an ESP32 with Arduino. For the</span>
<span class="sd">exact script used for this example see `here &lt;https://github.com/nkolban/ESP32_BLE_Arduino/blob/6bad7b42a96f0aa493323ef4821a8efb0e8815f2/examples/BLE_notify/BLE_notify.ino/&gt;`_</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">bluepy.btle</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">simpleble</span> <span class="kn">import</span> <span class="n">SimpleBleClient</span><span class="p">,</span> <span class="n">SimpleBleDevice</span>

<span class="c1"># The UUID of the characteristic we want to read and the name of the device # we want to read it from</span>
<span class="n">Characteristic_UUID</span> <span class="o">=</span> <span class="s2">&quot;beb5483e-36e1-4688-b7f5-ea07361b26a8&quot;</span>
<span class="n">Device_Name</span> <span class="o">=</span> <span class="s2">&quot;MyESP32&quot;</span>

<span class="c1"># Define our scan and notification callback methods</span>
<span class="k">def</span> <span class="nf">myScanCallback</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">isNewDevice</span><span class="p">,</span> <span class="n">isNewData</span><span class="p">):</span>
    <span class="n">client</span><span class="o">.</span><span class="n">_yes</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#MAC: &quot;</span> <span class="o">+</span> <span class="n">device</span><span class="o">.</span><span class="n">addr</span> <span class="o">+</span> <span class="s2">&quot; #isNewDevice: &quot;</span> <span class="o">+</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">isNewDevice</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; #isNewData: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">isNewData</span><span class="p">))</span>
<span class="c1"># TODO: NOTIFICATIONS ARE NOT SUPPORTED YET</span>
<span class="c1"># def myNotificationCallback(client, characteristic, data):</span>
<span class="c1">#     print(&quot;Notification received!&quot;)</span>
<span class="c1">#     print(&quot;  Characteristic UUID: &quot; + characteristic.uuid)</span>
<span class="c1">#     print(&quot;  Data: &quot; + str(data))</span>

<span class="c1"># Instantiate a SimpleBleClient and set it&#39;s scan callback</span>
<span class="n">bleClient</span> <span class="o">=</span> <span class="n">SimpleBleClient</span><span class="p">()</span>
<span class="n">bleClient</span><span class="o">.</span><span class="n">setScanCallback</span><span class="p">(</span><span class="n">myScanCallback</span><span class="p">)</span>
<span class="c1"># TODO: NOTIFICATIONS ARE NOT SUPPORTED YET</span>
<span class="c1"># bleClient.setNotificationCallback(myNotificationCollback)</span>

<span class="c1"># Error handling to detect Keyboard interrupt (Ctrl+C)</span>
<span class="c1"># Loop to ensure we can survive connection drops</span>
<span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="n">bleClient</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Search for 2 seconds and return a device of interest if found.</span>
        <span class="c1"># Internally this makes a call to bleClient.scan(timeout), thus</span>
        <span class="c1"># triggering the scan callback method when nearby devices are detected</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">bleClient</span><span class="o">.</span><span class="n">searchDevice</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyESP32&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># If the device was found print out it&#39;s info</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found device!!&quot;</span><span class="p">)</span>
            <span class="n">device</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>

            <span class="c1"># Proceed to connect to the device</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Proceeding to connect....&quot;</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">bleClient</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">device</span><span class="p">)):</span>

                <span class="c1"># Have a peek at the services provided by the device</span>
                <span class="n">services</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">getServices</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Service [&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>

                <span class="c1"># Check to see if the device provides a characteristic with the</span>
                <span class="c1"># desired UUID</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="n">bleClient</span><span class="o">.</span><span class="n">getCharacteristics</span><span class="p">(</span>
                    <span class="n">uuids</span><span class="o">=</span><span class="p">[</span><span class="n">Characteristic_UUID</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span><span class="p">(</span><span class="n">counter</span><span class="p">):</span>
                    <span class="c1"># If it does, then we proceed to read its value every second</span>
                    <span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
                        <span class="c1"># Error handling ensures that we can survive from</span>
                        <span class="c1"># potential connection drops</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Read the data as bytes and convert to string</span>
                            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">bleClient</span><span class="o">.</span><span class="n">readCharacteristic</span><span class="p">(</span>
                                <span class="n">counter</span><span class="p">)</span>
                            <span class="n">data_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">))</span>

                            <span class="c1"># Now print the data and wait for a second</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data: &quot;</span> <span class="o">+</span> <span class="n">data_str</span><span class="p">)</span>
                            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="c1"># If we get disconnected from the device, keep</span>
                            <span class="c1"># looping until we have reconnected</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">BTLEException</span><span class="o">.</span><span class="n">DISCONNECTED</span><span class="p">):</span>
                                <span class="n">bleClient</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot;Connection to BLE device has been lost!&quot;</span><span class="p">)</span>
                                <span class="k">break</span>
                                <span class="c1"># while(not bleClient.isConnected()):</span>
                                <span class="c1">#     bleClient.connect(device)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not connect to device! Retrying in 3 sec...&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Device not found! Retrying in 3 sec...&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># If we get disconnected from the device, keep</span>
        <span class="c1"># looping until we have reconnected</span>
        <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">BTLEException</span><span class="o">.</span><span class="n">DISCONNECTED</span><span class="p">):</span>
            <span class="n">bleClient</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Connection to BLE device has been lost!&quot;</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Detect keyboard interrupt and close down</span>
        <span class="c1"># bleClient gracefully</span>
        <span class="n">bleClient</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="intro.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="source/pydgn.data.html" class="btn btn-neutral float-right" title="pydgn.data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Federico Errica.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>